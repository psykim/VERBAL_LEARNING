<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CERAD NP WLMT/WLRT/WLRcT Analyzer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .card-header {
            padding: 20px;
            border-bottom: 1px solid #e5e5e5;
        }

        .card-title {
            font-size: 24px;
            font-weight: 600;
            text-align: center;
        }

        .card-content {
            padding: 20px;
        }

        .tabs {
            margin-bottom: 20px;
        }

        .tab-list {
            display: flex;
            border-bottom: 2px solid #e5e5e5;
            margin-bottom: 20px;
        }

        .tab-trigger {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            color: #666;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            transition: all 0.3s;
        }

        .tab-trigger:hover {
            color: #333;
        }

        .tab-trigger.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            color: #555;
        }

        input[type="number"], select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .grid {
            display: grid;
            gap: 16px;
        }

        .grid-cols-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .grid-cols-4 {
            grid-template-columns: repeat(4, 1fr);
        }

        .grid-cols-5 {
            grid-template-columns: repeat(5, 1fr);
        }

        .grid-cols-2 {
            grid-template-columns: repeat(2, 1fr);
        }

        .button {
            background: #3b82f6;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }

        .button:hover {
            background: #2563eb;
        }

        .button.outline {
            background: white;
            color: #333;
            border: 1px solid #ddd;
        }

        .button.outline:hover {
            background: #f5f5f5;
        }

        .button.active {
            background: #3b82f6;
            color: white;
        }

        .button.sm {
            padding: 6px 12px;
            font-size: 14px;
        }

        .button.full-width {
            width: 100%;
        }

        .word-button {
            position: relative;
        }

        .word-order {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #6b7280;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .selected-words {
            min-height: 60px;
            padding: 12px;
            border: 1px solid #e5e5e5;
            border-radius: 4px;
            background: #f9f9f9;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            margin: 2px;
        }

        .badge.default {
            background: #3b82f6;
            color: white;
        }

        .badge.destructive {
            background: #ef4444;
            color: white;
        }

        .badge.outline {
            background: white;
            border: 1px solid #ddd;
            color: #333;
        }

        .badge .remove {
            margin-left: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        .recognition-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border: 1px solid #e5e5e5;
            border-radius: 4px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .alert {
            padding: 16px;
            border: 1px solid #e5e5e5;
            border-radius: 4px;
            background: #f9f9f9;
            margin-bottom: 16px;
        }

        .text-gray-600 {
            color: #666;
        }

        .text-gray-500 {
            color: #999;
        }

        .text-sm {
            font-size: 14px;
        }

        .text-xs {
            font-size: 12px;
        }

        .text-lg {
            font-size: 18px;
        }

        .text-xl {
            font-size: 20px;
        }

        .font-bold {
            font-weight: 700;
        }

        .font-semibold {
            font-weight: 600;
        }

        .space-y-4 > * + * {
            margin-top: 16px;
        }

        .space-y-6 > * + * {
            margin-top: 24px;
        }

        .flex {
            display: flex;
        }

        .flex-wrap {
            flex-wrap: wrap;
        }

        .items-center {
            align-items: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .gap-1 {
            gap: 4px;
        }

        .gap-2 {
            gap: 8px;
        }

        .gap-3 {
            gap: 12px;
        }

        .gap-4 {
            gap: 16px;
        }

        .clickable {
            cursor: pointer;
        }

        .clickable:hover {
            text-decoration: underline;
        }

        .info-icon {
            display: inline-block;
            width: 12px;
            height: 12px;
            background: #6b7280;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 12px;
            font-size: 10px;
            font-weight: bold;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            margin: 20px;
        }

        .modal-header {
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }

        .modal-description {
            white-space: pre-line;
            line-height: 1.6;
        }

        .modal-close {
            float: right;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            color: #999;
        }

        .modal-close:hover {
            color: #333;
        }

        @media (max-width: 768px) {
            .grid-cols-3, .grid-cols-4, .grid-cols-5 {
                grid-template-columns: 1fr;
            }

            .grid-cols-2 {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="card-header">
                <h1 class="card-title">CERAD NP WLMT/WLRT/WLRcT Analyzer</h1>
            </div>
            <div class="card-content">
                <div class="tabs">
                    <div class="tab-list">
                        <button class="tab-trigger active" data-tab="input">검사 입력</button>
                        <button class="tab-trigger" data-tab="results">결과 분석</button>
                    </div>

                    <!-- 검사 입력 탭 -->
                    <div id="input-tab" class="tab-content active">
                        <!-- 기본 정보 -->
                        <div class="grid grid-cols-3 gap-4">
                            <div class="form-group">
                                <label>연령</label>
                                <input type="number" id="age" placeholder="연령 입력">
                            </div>
                            <div class="form-group">
                                <label>교육년수</label>
                                <input type="number" id="education" placeholder="교육년수">
                            </div>
                            <div class="form-group">
                                <label>성별</label>
                                <select id="gender">
                                    <option value="M">남성</option>
                                    <option value="F">여성</option>
                                </select>
                            </div>
                        </div>

                        <!-- 회상 검사 -->
                        <div class="space-y-6">
                            <h3 class="section-title">회상 검사</h3>
                            <div class="tab-list">
                                <button class="tab-trigger active" data-trial="trial1">시행 1</button>
                                <button class="tab-trigger" data-trial="trial2">시행 2</button>
                                <button class="tab-trigger" data-trial="trial3">시행 3</button>
                                <button class="tab-trigger" data-trial="delayed">지연 회상</button>
                            </div>

                            <div id="trial-content">
                                <div class="flex justify-between items-center">
                                    <p class="text-sm text-gray-600">피검자가 회상한 순서대로 단어를 클릭하세요.</p>
                                    <button class="button button.sm outline" onclick="clearCurrentTrial()">초기화</button>
                                </div>

                                <div id="word-grid" class="grid grid-cols-5 gap-2" style="margin-top: 16px;"></div>

                                <div style="margin-top: 20px;">
                                    <label>회상된 단어 (순서대로)</label>
                                    <div id="selected-words" class="selected-words">
                                        <p class="text-sm text-gray-500">선택된 단어가 없습니다.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 재인 검사 -->
                        <div class="space-y-6">
                            <h3 class="section-title">재인 검사</h3>
                            <div id="recognition-grid" class="grid grid-cols-2 gap-4"></div>
                        </div>

                        <button class="button full-width" onclick="calculateResults()" style="margin-top: 24px;">결과 분석</button>
                    </div>

                    <!-- 결과 분석 탭 -->
                    <div id="results-tab" class="tab-content">
                        <div id="results-container"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 점수 설명 모달 -->
    <div id="score-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <div class="modal-header">
                <h2 id="modal-title" class="modal-title"></h2>
            </div>
            <p id="modal-description" class="modal-description"></p>
        </div>
    </div>

    <script>
        // 단어 목록
        const wordList = ['우유', '팔', '바다', '편지', '왕', '가구', '지붕', '붓', '싹', '기계'];
        
        // 시행별 제시 순서
        const presentationOrders = {
            trial1: ['우유', '팔', '바다', '편지', '왕', '가구', '지붕', '붓', '싹', '기계'],
            trial2: ['붓', '가구', '우유', '바다', '기계', '팔', '왕', '편지', '지붕', '싹'],
            trial3: ['왕', '싹', '팔', '가구', '지붕', '바다', '우유', '기계', '붓', '편지']
        };
        
        // 재인 검사 단어 순서
        const recognitionWords = [
            '교회', '콜라', '우유', '돈', '팔', '바다', '다섯', '편지', '호텔', '산',
            '왕', '가구', '신발', '지붕', '마을', '줄', '붓', '군대', '싹', '기계'
        ];
        
        // 연령별 규준
        const norms = {
            '50-59': { immediate: { mean: 22.5, sd: 3.2 }, delayed: { mean: 7.2, sd: 1.8 }, recognition: { mean: 9.5, sd: 0.8 } },
            '60-69': { immediate: { mean: 20.3, sd: 3.5 }, delayed: { mean: 6.5, sd: 2.0 }, recognition: { mean: 9.2, sd: 1.0 } },
            '70-79': { immediate: { mean: 17.8, sd: 3.8 }, delayed: { mean: 5.5, sd: 2.2 }, recognition: { mean: 8.8, sd: 1.3 } },
            '80+': { immediate: { mean: 15.2, sd: 4.0 }, delayed: { mean: 4.2, sd: 2.3 }, recognition: { mean: 8.0, sd: 1.8 } }
        };

        // 점수 설명
        const scoreDescriptions = {
            trial1: {
                title: "시행 1 점수",
                description: "첫 번째 학습 시행에서 정확하게 회상한 단어의 개수입니다.\n\n산출방법: 제시된 10개 단어 중 정확하게 회상한 단어 수\n\n임상적 의미: 초기 학습 능력과 즉각적 기억 용량을 평가합니다. 정상 범위는 연령에 따라 다르며, 일반적으로 4-7개입니다."
            },
            trial2: {
                title: "시행 2 점수",
                description: "두 번째 학습 시행에서 정확하게 회상한 단어의 개수입니다.\n\n산출방법: 제시된 10개 단어 중 정확하게 회상한 단어 수\n\n임상적 의미: 반복 학습을 통한 개선 정도를 평가합니다. 시행 1보다 1-3개 증가하는 것이 정상입니다."
            },
            trial3: {
                title: "시행 3 점수",
                description: "세 번째 학습 시행에서 정확하게 회상한 단어의 개수입니다.\n\n산출방법: 제시된 10개 단어 중 정확하게 회상한 단어 수\n\n임상적 의미: 최대 학습 능력을 평가합니다. 이 점수가 지연 회상의 기준점이 됩니다."
            },
            totalLearning: {
                title: "총 학습량",
                description: "3회 시행 동안 회상한 단어의 총합입니다.\n\n산출방법: 시행1 + 시행2 + 시행3\n\n임상적 의미: 전반적인 학습 능력을 평가합니다. 연령별 정상 범위와 비교하여 기억 장애 여부를 판단합니다."
            },
            delayedRecall: {
                title: "지연 회상",
                description: "5-10분 후 단서 없이 회상한 단어의 개수입니다.\n\n산출방법: 지연 후 정확하게 회상한 단어 수\n\n임상적 의미: 정보의 고착과 인출 능력을 평가합니다. 최대 학습의 70% 이상 유지가 정상입니다."
            },
            recognitionTotal: {
                title: "재인",
                description: "재인 검사에서의 종합 점수입니다.\n\n산출방법: (정확 재인 + 정확 기각) - 10\n\n임상적 의미: 저장된 정보를 인식하는 능력을 평가합니다. 8/10 이상이 정상 범위입니다."
            },
            hits: {
                title: "정확 재인",
                description: "목표 단어를 정확하게 '예'라고 인식한 개수입니다.\n\n산출방법: 10개 목표 단어 중 '예'라고 응답한 수\n\n임상적 의미: 학습한 정보를 정확히 인식하는 능력을 나타냅니다. 9-10개가 정상입니다."
            },
            correctRejections: {
                title: "정확 기각",
                description: "방해자극을 정확하게 '아니오'라고 거부한 개수입니다.\n\n산출방법: 10개 방해자극 중 '아니오'라고 응답한 수\n\n임상적 의미: 간섭 자극을 배제하는 능력을 평가합니다. 9-10개가 정상입니다."
            },
            learningSlope: {
                title: "학습 기울기",
                description: "첫 시행과 마지막 시행 간의 개선 정도입니다.\n\n산출방법: 시행3 - 시행1\n\n임상적 의미: 양수값은 학습이 일어났음을 의미합니다. 2-4가 정상 범위이며, 0 이하는 학습 장애를 시사합니다."
            },
            learningRate: {
                title: "학습률",
                description: "첫 시행 대비 학습 개선의 백분율입니다.\n\n산출방법: ((시행3 - 시행1) / 시행1) × 100\n\n임상적 의미: 50-100%가 정상 범위입니다. 낮은 학습률은 새로운 정보 습득의 어려움을 나타냅니다."
            },
            learningEfficiency: {
                title: "학습 효율성",
                description: "평균적인 시행 간 개선 정도입니다.\n\n산출방법: (시행3 - 시행1) / 2\n\n임상적 의미: 1 이상이 정상입니다. SRT 검사에서 차용한 지표로, 학습의 일관성을 평가합니다."
            },
            savingsScore: {
                title: "절약 점수",
                description: "최대 학습 대비 지연 회상의 비율입니다.\n\n산출방법: (지연회상 / 최대학습) × 100\n\n임상적 의미: CERAD 고유 지표로, 70% 이상이 정상입니다. 50% 미만은 가속화된 망각을 의미합니다."
            },
            forgettingRate: {
                title: "망각률",
                description: "최대 학습 후 잊어버린 정보의 비율입니다.\n\n산출방법: ((최대학습 - 지연회상) / 최대학습) × 100\n\n임상적 의미: 30% 이하가 정상입니다. 높은 망각률은 해마 손상을 시사할 수 있습니다."
            },
            retentionIndex: {
                title: "보유 지수",
                description: "최고 학습 시점 대비 지연 회상 비율입니다.\n\n산출방법: (지연회상 / MAX(시행2, 시행3)) × 100\n\n임상적 의미: HVLT-R에서 차용한 지표로, 85% 이상이 우수, 70-85%가 정상입니다."
            },
            retrievalEfficiency: {
                title: "인출 효율성",
                description: "저장된 정보를 인출하는 효율성입니다.\n\n산출방법: (지연회상 / 최대학습) × 100\n\n임상적 의미: 절약점수와 유사하나 인출 과정에 초점을 둡니다. 낮은 점수는 인출 결함을 시사합니다."
            },
            consistencyPercent: {
                title: "일관성 비율",
                description: "시행 간 동일한 단어를 일관되게 회상하는 정도입니다.\n\n산출방법: (연속 시행간 공통 회상 단어 / 총 회상) × 100\n\n임상적 의미: CVLT에서 차용한 지표로, 70% 이상이 정상입니다. 낮은 일관성은 불안정한 학습을 의미합니다."
            },
            dPrime: {
                title: "d' (변별력)",
                description: "신호탐지이론에 기반한 재인 변별 능력입니다.\n\n산출방법: Z(적중률) - Z(오경보율)\n\n임상적 의미: 2.5 이상이 정상입니다. 1.5 미만은 저장 결함을, 높은 d'은 인출 결함을 시사합니다."
            },
            beta: {
                title: "β (반응 편향)",
                description: "재인 검사에서의 응답 경향성입니다.\n\n산출방법: exp((Z(오경보)² - Z(적중)²) / 2)\n\n임상적 의미: 1에 가까울수록 균형잡힌 반응입니다. 1보다 크면 보수적, 작으면 자유로운 반응 경향을 나타냅니다."
            },
            recognitionEfficiency: {
                title: "재인 효율성",
                description: "재인과 자유회상 간의 차이입니다.\n\n산출방법: 적중 - 지연회상\n\n임상적 의미: SVLT에서 차용한 지표로, 3 이상은 인출 결함을, 0-2는 저장 결함을 시사합니다."
            },
            intrusions: {
                title: "침입 오류",
                description: "목록에 없는 단어를 회상한 횟수입니다.\n\n산출방법: 10개 목표 단어가 아닌 단어를 말한 총 횟수\n\n임상적 의미: 5개 이하가 정상입니다. 증가된 침입은 전두엽 기능 저하나 혼동을 시사합니다."
            },
            repetitions: {
                title: "반복 오류",
                description: "같은 시행 내에서 단어를 반복한 횟수입니다.\n\n산출방법: 각 시행 내 중복 응답 수의 합\n\n임상적 의미: 2개 이하가 정상입니다. 증가된 반복은 모니터링 능력 저하를 의미합니다."
            },
            primacyEffect: {
                title: "초두 효과",
                description: "회상 초반부(1-3번째)에 나온 단어의 비율입니다.\n\n산출방법: (1-3번째 회상 단어 / 총 정확 회상) × 100\n\n임상적 의미: 정상적으로는 40% 이상입니다. 감소는 장기 기억 전환의 어려움을 시사합니다."
            },
            recencyEffect: {
                title: "최신 효과",
                description: "회상 후반부(8-10번째)에 나온 단어의 비율입니다.\n\n산출방법: (8-10번째 회상 단어 / 총 정확 회상) × 100\n\n임상적 의미: 정상적으로는 30% 이상입니다. 감소는 단기 기억 저장의 문제를 시사합니다."
            },
            zScore: {
                title: "Z 점수",
                description: "연령 규준 대비 표준편차 단위의 점수입니다.\n\n산출방법: (원점수 - 연령평균) / 표준편차\n\n임상적 의미:\n• 0 이상: 정상\n• -1.0 ~ 0: 경계선\n• -1.5 ~ -1.0: 경미한 손상\n• -2.0 ~ -1.5: 중등도 손상\n• -2.0 미만: 심각한 손상"
            },
            tScore: {
                title: "T 점수",
                description: "평균 50, 표준편차 10으로 변환한 표준점수입니다.\n\n산출방법: 50 + (Z점수 × 10)\n\n임상적 의미:\n• 45-55: 평균 범위\n• 40-44: 경미한 저하\n• 30-39: 중등도 저하\n• 30 미만: 심각한 저하"
            },
            percentile: {
                title: "백분위",
                description: "동일 연령대에서의 상대적 위치입니다.\n\n산출방법: 정규분포 누적확률 × 100\n\n임상적 의미:\n• 25%ile 이상: 정상\n• 16-24%ile: 경계선\n• 9-15%ile: 경미한 손상\n• 3-8%ile: 중등도 손상\n• 2%ile 이하: 심각한 손상"
            },
            firstTrialMemory: {
                title: "첫 시행 기억",
                description: "첫 번째 시행에서의 즉각 회상 능력입니다.\n\n산출방법: 시행1 점수\n\n임상적 의미: PAL에서 차용한 개념으로, 4개 이상이 정상입니다. 초기 부호화 능력을 반영합니다."
            },
            estimatedLTS: {
                title: "추정 장기저장",
                description: "3회 시행 모두에서 일관되게 회상된 단어 수입니다.\n\n산출방법: 시행1, 2, 3 모두에서 회상된 단어 수\n\n임상적 의미: SRT에서 차용한 개념으로, 안정적으로 저장된 정보량을 추정합니다."
            },
            contrastScaledScore: {
                title: "대조 척도점수",
                description: "기대 지연회상 대비 실제 수행입니다.\n\n산출방법: 12 + ((실제지연 - 기대지연) / 2)\n기대지연 = 총학습 × 0.75\n\n임상적 의미: WMS에서 차용한 개념으로, 12가 평균이며 9-15가 정상 범위입니다."
            },
            cueingEffect: {
                title: "단서 효과",
                description: "재인이 자유회상보다 나은 정도입니다.\n\n산출방법: 재인적중 - 지연회상\n\n임상적 의미: FCSRT 개념을 응용한 것으로, 3 이상은 인출 결함을, 0-2는 저장 결함을 시사합니다."
            },
            recallStrategy: {
                title: "회상 전략",
                description: "단어를 회상하는 순서의 패턴입니다.\n\n분석방법: 제시 순서와 회상 순서의 일치도 분석\n\n임상적 의미: 계열적 전략은 효율적 학습을, 무작위 전략은 비조직적 학습을 나타냅니다."
            }
        };

        // 상태 관리
        let activeTrial = 'trial1';
        let activeTab = 'input';
        let trialResponses = {
            trial1: [],
            trial2: [],
            trial3: [],
            delayed: []
        };
        let recognition = new Array(20).fill(null);
        let results = null;

        // 초기화
        function init() {
            setupTabs();
            setupTrialTabs();
            renderWordGrid();
            renderRecognitionGrid();
        }

        // 탭 설정
        function setupTabs() {
            document.querySelectorAll('.tab-trigger[data-tab]').forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetTab = this.dataset.tab;
                    
                    // 탭 버튼 활성화
                    document.querySelectorAll('.tab-trigger[data-tab]').forEach(t => {
                        t.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // 탭 콘텐츠 표시
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`${targetTab}-tab`).classList.add('active');
                    
                    activeTab = targetTab;
                });
            });
        }

        // 시행 탭 설정
        function setupTrialTabs() {
            document.querySelectorAll('.tab-trigger[data-trial]').forEach(tab => {
                tab.addEventListener('click', function() {
                    activeTrial = this.dataset.trial;
                    
                    // 탭 버튼 활성화
                    document.querySelectorAll('.tab-trigger[data-trial]').forEach(t => {
                        t.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // 단어 그리드 다시 렌더링
                    renderWordGrid();
                    updateSelectedWords();
                });
            });
        }

        // 단어 그리드 렌더링
        function renderWordGrid() {
            const grid = document.getElementById('word-grid');
            const words = activeTrial !== 'delayed' ? presentationOrders[activeTrial] : wordList;
            const responses = trialResponses[activeTrial];
            
            grid.innerHTML = '';
            
            words.forEach(word => {
                const response = responses.find(r => r.word === word);
                const isSelected = !!response;
                
                const button = document.createElement('button');
                button.className = `button word-button ${isSelected ? 'active' : 'outline'}`;
                button.textContent = word;
                button.onclick = () => handleWordClick(word);
                
                if (isSelected) {
                    const order = document.createElement('span');
                    order.className = 'word-order';
                    order.textContent = response.order;
                    button.appendChild(order);
                }
                
                grid.appendChild(button);
            });
        }

        // 재인 그리드 렌더링
        function renderRecognitionGrid() {
            const grid = document.getElementById('recognition-grid');
            grid.innerHTML = '';
            
            recognitionWords.forEach((word, idx) => {
                const item = document.createElement('div');
                item.className = 'recognition-item';
                item.innerHTML = `
                    <span class="font-semibold">${word}</span>
                    <div class="flex gap-2">
                        <button class="button sm ${recognition[idx] === 1 ? 'active' : 'outline'}" 
                                onclick="setRecognition(${idx}, 1)">예</button>
                        <button class="button sm ${recognition[idx] === 0 ? 'active' : 'outline'}" 
                                onclick="setRecognition(${idx}, 0)">아니오</button>
                    </div>
                `;
                grid.appendChild(item);
            });
        }

        // 단어 클릭 처리
        function handleWordClick(word) {
            const responses = trialResponses[activeTrial];
            const existingIndex = responses.findIndex(r => r.word === word);
            
            if (existingIndex === -1) {
                // 새로운 단어 추가
                trialResponses[activeTrial].push({
                    word: word,
                    order: responses.length + 1,
                    presentationOrder: presentationOrders[activeTrial]?.indexOf(word) + 1 || null
                });
            } else {
                // 기존 단어 제거
                trialResponses[activeTrial] = responses.filter(r => r.word !== word);
                // 순서 재정렬
                trialResponses[activeTrial].forEach((r, idx) => {
                    r.order = idx + 1;
                });
            }
            
            renderWordGrid();
            updateSelectedWords();
        }

        // 선택된 단어 업데이트
        function updateSelectedWords() {
            const container = document.getElementById('selected-words');
            const responses = trialResponses[activeTrial];
            
            if (responses.length === 0) {
                container.innerHTML = '<p class="text-sm text-gray-500">선택된 단어가 없습니다.</p>';
            } else {
                container.innerHTML = '<div class="flex flex-wrap gap-2">' +
                    responses
                        .sort((a, b) => a.order - b.order)
                        .map(response => {
                            const isValid = wordList.includes(response.word);
                            return `<span class="badge ${isValid ? 'default' : 'destructive'}">
                                ${response.order}. ${response.word}
                                <span class="remove" onclick="removeWord('${response.word}')">&times;</span>
                            </span>`;
                        })
                        .join('') +
                    '</div>';
            }
        }

        // 단어 제거
        function removeWord(word) {
            trialResponses[activeTrial] = trialResponses[activeTrial].filter(r => r.word !== word);
            trialResponses[activeTrial].forEach((r, idx) => {
                r.order = idx + 1;
            });
            renderWordGrid();
            updateSelectedWords();
        }

        // 현재 시행 초기화
        function clearCurrentTrial() {
            trialResponses[activeTrial] = [];
            renderWordGrid();
            updateSelectedWords();
        }

        // 재인 설정
        function setRecognition(idx, value) {
            recognition[idx] = value;
            renderRecognitionGrid();
        }

        // 모달 표시
        function showScoreDescription(scoreKey) {
            const description = scoreDescriptions[scoreKey];
            if (description) {
                document.getElementById('modal-title').textContent = description.title;
                document.getElementById('modal-description').textContent = description.description;
                document.getElementById('score-modal').classList.add('active');
            }
        }

        // 모달 닫기
        function closeModal() {
            document.getElementById('score-modal').classList.remove('active');
        }

        // 정규분포 역함수
        function normalInverse(p) {
            const a1 = -39.6968302866538, a2 = 220.946098424521, a3 = -275.928510446969;
            const a4 = 138.357751867269, a5 = -30.6647980661472, a6 = 2.50662827745924;
            const b1 = -54.4760987982241, b2 = 161.585836858041, b3 = -155.698979859887;
            const b4 = 66.8013118877197, b5 = -13.2806815528857;
            const c1 = -0.00778489400243029, c2 = -0.322396458041136, c3 = -2.40075827716184;
            const c4 = -2.54973253934373, c5 = 4.37466414146497, c6 = 2.93816398269878;
            
            if (p < 0.02425) {
                const q = Math.sqrt(-2 * Math.log(p));
                return (((((c1 * q + c2) * q + c3) * q + c4) * q + c5) * q + c6) / 
                       ((((b1 * q + b2) * q + b3) * q + b4) * q + b5) * q + 1;
            } else if (p < 0.97575) {
                const q = p - 0.5;
                const r = q * q;
                return (((((a1 * r + a2) * r + a3) * r + a4) * r + a5) * r + a6) * q /
                       (((((b1 * r + b2) * r + b3) * r + b4) * r + b5) * r + 1);
            } else {
                const q = Math.sqrt(-2 * Math.log(1 - p));
                return -(((((c1 * q + c2) * q + c3) * q + c4) * q + c5) * q + c6) / 
                        ((((b1 * q + b2) * q + b3) * q + b4) * q + b5) * q + 1;
            }
        }

        // 정규분포 누적분포함수
        function normalCDF(z) {
            const b1 = 0.319381530;
            const b2 = -0.356563782;
            const b3 = 1.781477937;
            const b4 = -1.821255978;
            const b5 = 1.330274429;
            const p = 0.2316419;
            const c = 0.39894228;
            
            if (z >= 0.0) {
                const t = 1.0 / (1.0 + p * z);
                return 1.0 - c * Math.exp(-z * z / 2.0) * t * 
                       (t * (t * (t * (t * b5 + b4) + b3) + b2) + b1);
            } else {
                const t = 1.0 / (1.0 - p * z);
                return c * Math.exp(-z * z / 2.0) * t * 
                       (t * (t * (t * (t * b5 + b4) + b3) + b2) + b1);
            }
        }

        // 연령대 구분
        function getAgeGroup(age) {
            const ageNum = parseInt(age);
            if (ageNum < 60) return '50-59';
            if (ageNum < 70) return '60-69';
            if (ageNum < 80) return '70-79';
            return '80+';
        }

        // Z점수 계산
        function calculateZScores(immediate, delayed, recognition, ageGroup) {
            const norm = norms[ageGroup];
            return {
                immediate: (immediate - norm.immediate.mean) / norm.immediate.sd,
                delayed: (delayed - norm.delayed.mean) / norm.delayed.sd,
                recognition: (recognition - norm.recognition.mean) / norm.recognition.sd
            };
        }

        // 반복 오류 계산
        function countRepetitions(trials) {
            let count = 0;
            Object.values(trials).forEach(trial => {
                const seen = {};
                trial.forEach(response => {
                    if (response.word && wordList.includes(response.word)) {
                        if (seen[response.word]) count++;
                        else seen[response.word] = true;
                    }
                });
            });
            return count;
        }

        // 계열 위치 효과 계산
        function calculateSerialPositionWithOrder(trials) {
            const positions = { primacy: 0, middle: 0, recency: 0 };
            
            Object.values(trials).forEach(trial => {
                trial.forEach(response => {
                    if (wordList.includes(response.word)) {
                        const recallOrder = response.order;
                        if (recallOrder <= 3) {
                            positions.primacy++;
                        } else if (recallOrder <= 7) {
                            positions.middle++;
                        } else {
                            positions.recency++;
                        }
                    }
                });
            });
            
            const totalCorrect = Object.values(trials).reduce((sum, trial) => 
                sum + trial.filter(r => wordList.includes(r.word)).length, 0);
            
            return {
                primacyEffect: totalCorrect > 0 ? (positions.primacy / totalCorrect) * 100 : 0,
                middleRecall: totalCorrect > 0 ? (positions.middle / totalCorrect) * 100 : 0,
                recencyEffect: totalCorrect > 0 ? (positions.recency / totalCorrect) * 100 : 0
            };
        }

        // 회상 순서 분석
        function analyzeRecallOrder(trials) {
            let forwardRecall = 0;
            
            ['trial1', 'trial2', 'trial3'].forEach((trialName, trialIndex) => {
                const trial = trials[trialName];
                const presentOrder = Object.values(presentationOrders)[trialIndex];
                const correctResponses = trial.filter(r => wordList.includes(r.word));
                
                for (let i = 0; i < correctResponses.length - 1; i++) {
                    const currentWord = correctResponses[i].word;
                    const nextWord = correctResponses[i + 1].word;
                    
                    const currentPresentIndex = presentOrder.indexOf(currentWord);
                    const nextPresentIndex = presentOrder.indexOf(nextWord);
                    
                    if (nextPresentIndex === currentPresentIndex + 1) {
                        forwardRecall++;
                    }
                }
            });
            
            const strategy = forwardRecall > 2 ? '계열적 전략' : '무작위 전략';
            
            return {
                forwardRecall,
                strategy
            };
        }

        // 학습 곡선 분류
        function categorizeLearningCurve(t1, t2, t3) {
            const slope1 = t2 - t1;
            const slope2 = t3 - t2;
            
            if (slope1 > 2 && slope2 > 1) return '급격한 상승';
            if (slope1 > 1 && slope2 >= 0) return '정상적 학습';
            if (slope1 >= 0 && slope2 >= 0 && slope1 + slope2 < 2) return '완만한 학습';
            if (slope1 < 0 || slope2 < 0) return '불규칙한 학습';
            return '평탄한 학습';
        }

        // 대조 척도점수 계산
        function calculateContrastScore(immediate, delayed) {
            const expectedDelayed = immediate * 0.75;
            const difference = delayed - expectedDelayed;
            if (difference >= 0) return 12 + Math.min(3, Math.floor(difference / 2));
            else return 12 + Math.max(-3, Math.floor(difference / 2));
        }

        // 임상적 해석 생성
        function generateInterpretation(zScores, savings, dPrime, intrusions) {
            const interpretations = [];
            
            if (zScores.immediate < -2) {
                interpretations.push('즉각 기억에서 심각한 손상이 관찰됩니다.');
            } else if (zScores.immediate < -1.5) {
                interpretations.push('즉각 기억에서 중등도 손상이 관찰됩니다.');
            } else if (zScores.immediate < -1) {
                interpretations.push('즉각 기억에서 경미한 손상이 관찰됩니다.');
            }
            
            if (savings < 50) {
                interpretations.push('가속화된 망각이 시사되며, 이는 해마 기능 장애를 나타낼 수 있습니다.');
            } else if (savings > 90) {
                interpretations.push('우수한 정보 보유를 보이고 있습니다.');
            }
            
            if (dPrime < 1.5) {
                interpretations.push('재인 변별력이 저하되어 있어 저장 결함을 시사합니다.');
            } else if (dPrime > 3.0) {
                interpretations.push('재인 수행이 양호하여 인출 결함 패턴을 보입니다.');
            }
            
            if (intrusions > 5) {
                interpretations.push('침입 오류가 증가되어 있어 전두엽 기능 저하가 의심됩니다.');
            }
            
            if (zScores.immediate < -1.5 && savings < 60 && dPrime < 2) {
                interpretations.push('알츠하이머병 가능성을 시사하는 기억 프로파일을 보입니다.');
            } else if (zScores.immediate < -1 && savings > 80 && intrusions > 3) {
                interpretations.push('전두엽/피질하 유형의 기억 장애 패턴을 보입니다.');
            }
            
            return interpretations;
        }

        // 결과 계산
        function calculateResults() {
            // 기본 점수 계산
            const t1Score = trialResponses.trial1.filter(r => wordList.includes(r.word)).length;
            const t2Score = trialResponses.trial2.filter(r => wordList.includes(r.word)).length;
            const t3Score = trialResponses.trial3.filter(r => wordList.includes(r.word)).length;
            const delayedScore = trialResponses.delayed.filter(r => wordList.includes(r.word)).length;
            
            // 재인 점수 계산
            let hits = 0;
            let correctRejections = 0;
            let falseAlarms = 0;
            let misses = 0;
            
            recognitionWords.forEach((word, idx) => {
                if (wordList.includes(word)) {
                    if (recognition[idx] === 1) hits++;
                    else if (recognition[idx] === 0) misses++;
                } else {
                    if (recognition[idx] === 0) correctRejections++;
                    else if (recognition[idx] === 1) falseAlarms++;
                }
            });
            
            // 기본 측정치
            const totalLearning = t1Score + t2Score + t3Score;
            const maxLearning = Math.max(t1Score, t2Score, t3Score);
            const learningSlope = t3Score - t1Score;
            
            // 절약 점수
            const savingsScore = maxLearning > 0 ? (delayedScore / maxLearning) * 100 : 0;
            
            // 망각률
            const forgettingRate = maxLearning > 0 ? ((maxLearning - delayedScore) / maxLearning) * 100 : 0;
            
            // 학습률
            const learningRate = t1Score > 0 ? ((t3Score - t1Score) / t1Score) * 100 : 0;
            
            // 재인 지표
            const recognitionTotal = hits + correctRejections;
            const recognitionScore = recognitionTotal - 10;
            const hitRate = hits / 10;
            const falseAlarmRate = falseAlarms / 10;
            
            // d'
            const zHit = hitRate === 1 ? 2.5 : hitRate === 0 ? -2.5 : normalInverse(hitRate);
            const zFA = falseAlarmRate === 1 ? 2.5 : falseAlarmRate === 0 ? -2.5 : normalInverse(falseAlarmRate);
            const dPrime = zHit - zFA;
            
            // β
            const beta = Math.exp((Math.pow(zFA, 2) - Math.pow(zHit, 2)) / 2);
            
            // 학습 일관성
            let consistency = 0;
            const t1Words = trialResponses.trial1.filter(r => wordList.includes(r.word)).map(r => r.word);
            const t2Words = trialResponses.trial2.filter(r => wordList.includes(r.word)).map(r => r.word);
            const t3Words = trialResponses.trial3.filter(r => wordList.includes(r.word)).map(r => r.word);
            
            t1Words.forEach(word => {
                if (t2Words.includes(word)) consistency++;
            });
            t2Words.forEach(word => {
                if (t3Words.includes(word)) consistency++;
            });
            
            const consistencyPercent = totalLearning > 0 ? (consistency / (totalLearning - t1Score)) * 100 : 0;
            
            // 오류 분석
            const allResponses = [
                ...trialResponses.trial1.map(r => r.word),
                ...trialResponses.trial2.map(r => r.word),
                ...trialResponses.trial3.map(r => r.word),
                ...trialResponses.delayed.map(r => r.word)
            ];
            
            const intrusions = allResponses.filter(word => word && !wordList.includes(word)).length;
            const repetitions = countRepetitions(trialResponses);
            
            // 계열 위치 효과
            const serialPosition = calculateSerialPositionWithOrder(trialResponses);
            
            // 학습 효율성
            const learningEfficiency = (t3Score - t1Score) / 2;
            
            // 인출 효율성
            const retrievalEfficiency = maxLearning > 0 ? (delayedScore / maxLearning) * 100 : 0;
            
            // 보유 지수
            const retentionIndex = Math.max(t2Score, t3Score) > 0 ? 
                (delayedScore / Math.max(t2Score, t3Score)) * 100 : 0;
            
            // 재인 효율성
            const recognitionEfficiency = hits - delayedScore;
            
            // 회상 순서 분석
            const recallOrderAnalysis = analyzeRecallOrder(trialResponses);
            
            // 연령 보정
            const age = document.getElementById('age').value;
            const ageGroup = getAgeGroup(age);
            const zScores = calculateZScores(totalLearning, delayedScore, recognitionScore, ageGroup);
            const tScores = {
                immediate: 50 + (zScores.immediate * 10),
                delayed: 50 + (zScores.delayed * 10),
                recognition: 50 + (zScores.recognition * 10)
            };
            
            // 백분위
            const percentiles = {
                immediate: normalCDF(zScores.immediate) * 100,
                delayed: normalCDF(zScores.delayed) * 100,
                recognition: normalCDF(zScores.recognition) * 100
            };
            
            // 임상적 해석
            const interpretation = generateInterpretation(zScores, savingsScore, dPrime, intrusions);
            
            // 추가 지표
            const additionalMetrics = {
                cueingEffect: recognitionEfficiency,
                firstTrialMemory: t1Score,
                estimatedLTS: t1Words.filter(word => t2Words.includes(word) && t3Words.includes(word)).length,
                learningPattern: categorizeLearningCurve(t1Score, t2Score, t3Score),
                contrastScaledScore: calculateContrastScore(totalLearning, delayedScore),
                recallStrategy: recallOrderAnalysis.strategy
            };
            
            results = {
                scores: {
                    trial1: t1Score,
                    trial2: t2Score,
                    trial3: t3Score,
                    totalLearning,
                    maxLearning,
                    delayedRecall: delayedScore,
                    recognition: {
                        hits,
                        correctRejections,
                        falseAlarms,
                        misses,
                        total: recognitionTotal,
                        score: recognitionScore
                    }
                },
                derived: {
                    learningSlope,
                    learningRate,
                    learningEfficiency,
                    savingsScore,
                    forgettingRate,
                    retentionIndex,
                    retrievalEfficiency,
                    consistencyPercent,
                    recognitionEfficiency,
                    dPrime,
                    beta,
                    cueingEffect: additionalMetrics.cueingEffect
                },
                errors: {
                    intrusions,
                    repetitions,
                    intrusionRate: (intrusions / (totalLearning + delayedScore + intrusions)) * 100,
                    repetitionRate: (repetitions / (totalLearning + delayedScore)) * 100
                },
                serialPosition,
                recallOrder: recallOrderAnalysis,
                standardScores: {
                    zScores,
                    tScores,
                    percentiles
                },
                additional: additionalMetrics,
                interpretation
            };
            
            displayResults();
            
            // 결과 탭으로 전환
            document.querySelector('.tab-trigger[data-tab="results"]').click();
        }

        // 결과 표시
        function displayResults() {
            if (!results) return;
            
            const container = document.getElementById('results-container');
            container.innerHTML = `
                <div class="space-y-6">
                    <!-- 기본 점수 -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="section-title">기본 점수</h3>
                        </div>
                        <div class="card-content space-y-4">
                            <div class="grid grid-cols-4 gap-3">
                                <div>
                                    <p class="text-xs text-gray-600 clickable flex items-center gap-1" onclick="showScoreDescription('trial1')">
                                        시행 1 (/10) <span class="info-icon">i</span>
                                    </p>
                                    <p class="text-xl font-bold">${results.scores.trial1}</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600 clickable flex items-center gap-1" onclick="showScoreDescription('trial2')">
                                        시행 2 (/10) <span class="info-icon">i</span>
                                    </p>
                                    <p class="text-xl font-bold">${results.scores.trial2}</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600 clickable flex items-center gap-1" onclick="showScoreDescription('trial3')">
                                        시행 3 (/10) <span class="info-icon">i</span>
                                    </p>
                                    <p class="text-xl font-bold">${results.scores.trial3}</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600 clickable flex items-center gap-1" onclick="showScoreDescription('totalLearning')">
                                        총 학습량 (/30) <span class="info-icon">i</span>
                                    </p>
                                    <p class="text-xl font-bold">${results.scores.totalLearning}</p>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-4 gap-3">
                                <div>
                                    <p class="text-xs text-gray-600 clickable flex items-center gap-1" onclick="showScoreDescription('delayedRecall')">
                                        지연 회상 (/10) <span class="info-icon">i</span>
                                    </p>
                                    <p class="text-xl font-bold">${results.scores.delayedRecall}</p>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-4 gap-3">
                                <div>
                                    <p class="text-xs text-gray-600 clickable flex items-center gap-1" onclick="showScoreDescription('recognitionTotal')">
                                        재인 (/10) <span class="info-icon">i</span>
                                    </p>
                                    <p class="text-xl font-bold">${results.scores.recognition.score}</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600 clickable flex items-center gap-1" onclick="showScoreDescription('hits')">
                                        정확 재인 (/10) <span class="info-icon">i</span>
                                    </p>
                                    <p class="text-xl font-bold">${results.scores.recognition.hits}</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600 clickable flex items-center gap-1" onclick="showScoreDescription('correctRejections')">
                                        정확 기각 (/10) <span class="info-icon">i</span>
                                    </p>
                                    <p class="text-xl font-bold">${results.scores.recognition.correctRejections}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 학습 및 기억 지표 -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="section-title">학습 및 기억 지표</h3>
                        </div>
                        <div class="card-content">
                            <div class="grid grid-cols-4 gap-3">
                                <div>
                                    <p class="text-xs text-gray-600 clickable flex items-center gap-1" onclick="showScoreDescription('learningSlope')">
                                        학습 기울기 <span class="info-icon">i</span>
                                    </p>
                                    <p class="text-lg font-semibold">${results.derived.learningSlope}</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600 clickable flex items-center gap-1" onclick="showScoreDescription('learningRate')">
                                        학습률 (%) <span class="info-icon">i</span>
                                    </p>
                                    <p class="text-lg font-semibold">${results.derived.learningRate.toFixed(1)}</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600 clickable flex items-center gap-1" onclick="showScoreDescription('learningEfficiency')">
                                        학습 효율성 <span class="info-icon">i</span>
                                    </p>
                                    <p class="text-lg font-semibold">${results.derived.learningEfficiency.toFixed(1)}</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600 clickable flex items-center gap-1" onclick="showScoreDescription('savingsScore')">
                                        절약 점수 (%) <span class="info-icon">i</span>
                                    </p>
                                    <p class="text-lg font-semibold">${results.derived.savingsScore.toFixed(1)}</p>
                                    <span class="badge ${results.derived.savingsScore < 50 ? 'destructive' : 'default'}">
                                        ${results.derived.savingsScore < 50 ? '가속 망각' : '정상'}
                                    </span>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600 clickable flex items-center gap-1" onclick="showScoreDescription('forgettingRate')">
                                        망각률 (%) <span class="info-icon">i</span>
                                    </p>
                                    <p class="text-lg font-semibold">${results.derived.forgettingRate.toFixed(1)}</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600 clickable flex items-center gap-1" onclick="showScoreDescription('retentionIndex')">
                                        보유 지수 (%) <span class="info-icon">i</span>
                                    </p>
                                    <p class="text-lg font-semibold">${results.derived.retentionIndex.toFixed(1)}</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600 clickable flex items-center gap-1" onclick="showScoreDescription('consistencyPercent')">
                                        일관성 (%) <span class="info-icon">i</span>
                                    </p>
                                    <p class="text-lg font-semibold">${results.derived.consistencyPercent.toFixed(1)}</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600 clickable flex items-center gap-1" onclick="showScoreDescription('retrievalEfficiency')">
                                        인출 효율성 (%) <span class="info-icon">i</span>
                                    </p>
                                    <p class="text-lg font-semibold">${results.derived.retrievalEfficiency.toFixed(1)}</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600 clickable flex items-center gap-1" onclick="showScoreDescription('recognitionEfficiency')">
                                        재인 효율성 <span class="info-icon">i</span>
                                    </p>
                                    <p class="text-lg font-semibold">${results.derived.recognitionEfficiency}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 재인 분석 -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="section-title">재인 분석 (신호탐지이론)</h3>
                        </div>
                        <div class="card-content">
                            <div class="grid grid-cols-4 gap-3">
                                <div>
                                    <p class="text-xs text-gray-600 clickable flex items-center gap-1" onclick="showScoreDescription('dPrime')">
                                        d' (변별력) <span class="info-icon">i</span>
                                    </p>
                                    <p class="text-lg font-semibold">${results.derived.dPrime.toFixed(2)}</p>
                                    <span class="badge ${results.derived.dPrime < 1.5 ? 'destructive' : 'default'}">
                                        ${results.derived.dPrime < 1.5 ? '저하' : '정상'}
                                    </span>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600 clickable flex items-center gap-1" onclick="showScoreDescription('beta')">
                                        β (반응편향) <span class="info-icon">i</span>
                                    </p>
                                    <p class="text-lg font-semibold">${results.derived.beta.toFixed(2)}</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600">오경보</p>
                                    <p class="text-lg font-semibold">${results.scores.recognition.falseAlarms}</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600">누락</p>
                                    <p class="text-lg font-semibold">${results.scores.recognition.misses}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 오류 분석 -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="section-title">오류 분석</h3>
                        </div>
                        <div class="card-content">
                            <div class="grid grid-cols-4 gap-3">
                                <div>
                                    <p class="text-xs text-gray-600 clickable flex items-center gap-1" onclick="showScoreDescription('intrusions')">
                                        침입 오류 <span class="info-icon">i</span>
                                    </p>
                                    <p class="text-lg font-semibold">${results.errors.intrusions}</p>
                                    <span class="badge ${results.errors.intrusions > 5 ? 'destructive' : 'default'}">
                                        ${results.errors.intrusions > 5 ? '증가' : '정상'}
                                    </span>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600 clickable flex items-center gap-1" onclick="showScoreDescription('repetitions')">
                                        반복 오류 <span class="info-icon">i</span>
                                    </p>
                                    <p class="text-lg font-semibold">${results.errors.repetitions}</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600">침입률 (%)</p>
                                    <p class="text-lg font-semibold">${results.errors.intrusionRate.toFixed(1)}</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600">반복률 (%)</p>
                                    <p class="text-lg font-semibold">${results.errors.repetitionRate.toFixed(1)}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 회상 순서 분석 -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="section-title">회상 순서 분석</h3>
                        </div>
                        <div class="card-content">
                            <div class="grid grid-cols-4 gap-3">
                                <div>
                                    <p class="text-xs text-gray-600 clickable flex items-center gap-1" onclick="showScoreDescription('primacyEffect')">
                                        초반 회상 (%) <span class="info-icon">i</span>
                                    </p>
                                    <p class="text-lg font-semibold">${results.serialPosition.primacyEffect.toFixed(1)}</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600">중반 회상 (%)</p>
                                    <p class="text-lg font-semibold">${results.serialPosition.middleRecall.toFixed(1)}</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600 clickable flex items-center gap-1" onclick="showScoreDescription('recencyEffect')">
                                        후반 회상 (%) <span class="info-icon">i</span>
                                    </p>
                                    <p class="text-lg font-semibold">${results.serialPosition.recencyEffect.toFixed(1)}</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600 clickable flex items-center gap-1" onclick="showScoreDescription('recallStrategy')">
                                        회상 전략 <span class="info-icon">i</span>
                                    </p>
                                    <span class="badge outline">${results.recallOrder.strategy}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 표준화 점수 -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="section-title">표준화 점수</h3>
                        </div>
                        <div class="card-content space-y-4">
                            <div>
                                <h5 class="font-semibold clickable flex items-center gap-1" onclick="showScoreDescription('zScore')">
                                    Z 점수 <span class="info-icon">i</span>
                                </h5>
                                <div class="grid grid-cols-3 gap-4">
                                    <div>
                                        <p class="text-sm text-gray-600">즉각 기억</p>
                                        <p class="text-xl font-semibold">${results.standardScores.zScores.immediate.toFixed(2)}</p>
                                        <span class="badge ${results.standardScores.zScores.immediate < -1.5 ? 'destructive' : 'default'}">
                                            ${results.standardScores.zScores.immediate < -2 ? '심각' : 
                                             results.standardScores.zScores.immediate < -1.5 ? '중등도' :
                                             results.standardScores.zScores.immediate < -1 ? '경미' : '정상'}
                                        </span>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">지연 기억</p>
                                        <p class="text-xl font-semibold">${results.standardScores.zScores.delayed.toFixed(2)}</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">재인</p>
                                        <p class="text-xl font-semibold">${results.standardScores.zScores.recognition.toFixed(2)}</p>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h5 class="font-semibold clickable flex items-center gap-1" onclick="showScoreDescription('tScore')">
                                    T 점수 <span class="info-icon">i</span>
                                </h5>
                                <div class="grid grid-cols-3 gap-4">
                                    <div>
                                        <p class="text-sm text-gray-600">즉각 기억</p>
                                        <p class="text-xl font-semibold">${results.standardScores.tScores.immediate.toFixed(0)}</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">지연 기억</p>
                                        <p class="text-xl font-semibold">${results.standardScores.tScores.delayed.toFixed(0)}</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">재인</p>
                                        <p class="text-xl font-semibold">${results.standardScores.tScores.recognition.toFixed(0)}</p>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h5 class="font-semibold clickable flex items-center gap-1" onclick="showScoreDescription('percentile')">
                                    백분위 <span class="info-icon">i</span>
                                </h5>
                                <div class="grid grid-cols-3 gap-4">
                                    <div>
                                        <p class="text-sm text-gray-600">즉각 기억</p>
                                        <p class="text-xl font-semibold">${results.standardScores.percentiles.immediate.toFixed(0)}%ile</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">지연 기억</p>
                                        <p class="text-xl font-semibold">${results.standardScores.percentiles.delayed.toFixed(0)}%ile</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">재인</p>
                                        <p class="text-xl font-semibold">${results.standardScores.percentiles.recognition.toFixed(0)}%ile</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 추가 지표 -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="section-title">추가 분석 지표</h3>
                        </div>
                        <div class="card-content">
                            <div class="grid grid-cols-4 gap-3">
                                <div>
                                    <p class="text-xs text-gray-600 clickable flex items-center gap-1" onclick="showScoreDescription('firstTrialMemory')">
                                        첫 시행 기억 (/10) <span class="info-icon">i</span>
                                    </p>
                                    <p class="text-lg font-semibold">${results.additional.firstTrialMemory}</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600 clickable flex items-center gap-1" onclick="showScoreDescription('estimatedLTS')">
                                        추정 장기저장 <span class="info-icon">i</span>
                                    </p>
                                    <p class="text-lg font-semibold">${results.additional.estimatedLTS}</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600">학습 패턴</p>
                                    <p class="text-lg font-semibold">${results.additional.learningPattern}</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600 clickable flex items-center gap-1" onclick="showScoreDescription('contrastScaledScore')">
                                        대조 척도점수 <span class="info-icon">i</span>
                                    </p>
                                    <p class="text-lg font-semibold">${results.additional.contrastScaledScore}</p>
                                </div>
                                <div>
                                    <p class="text-xs text-gray-600 clickable flex items-center gap-1" onclick="showScoreDescription('cueingEffect')">
                                        단서 효과 <span class="info-icon">i</span>
                                    </p>
                                    <p class="text-lg font-semibold">${results.additional.cueingEffect}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 임상적 해석 -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="section-title">임상적 해석</h3>
                        </div>
                        <div class="card-content">
                            <div class="space-y-2">
                                ${results.interpretation.map(interp => `
                                    <div class="alert">
                                        <p>${interp}</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    
                    <!-- 인지 프로파일 요약 -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="section-title">인지 프로파일 요약</h3>
                        </div>
                        <div class="card-content">
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span>부호화 vs 인출</span>
                                    <span class="badge">
                                        ${results.derived.recognitionEfficiency > 3 ? '인출 결함 우세' : '부호화 결함 우세'}
                                    </span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span>학습 패턴</span>
                                    <span class="badge">${results.additional.learningPattern}</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span>기억 보유</span>
                                    <span class="badge ${results.derived.savingsScore < 70 ? 'destructive' : 'default'}">
                                        ${results.derived.savingsScore < 50 ? '급속 망각' : 
                                         results.derived.savingsScore < 70 ? '가속 망각' : '정상 보유'}
                                    </span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span>전두엽 기능</span>
                                    <span class="badge ${results.errors.intrusions > 5 ? 'destructive' : 'default'}">
                                        ${results.errors.intrusions > 5 ? '저하 의심' : '정상'}
                                    </span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span>회상 전략</span>
                                    <span class="badge">${results.additional.recallStrategy}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // 모달 외부 클릭 시 닫기
        window.onclick = function(event) {
            const modal = document.getElementById('score-modal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // 초기화 실행
        init();
    </script>
</body>
</html>